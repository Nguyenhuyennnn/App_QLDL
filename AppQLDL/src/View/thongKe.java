/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package View;

import Controller.Dao;
import Controller.KNCSDL;
import Controller.UrlKN;
import Controller.XLDL;
import csdl.TblDattour;
import csdl.TblHoadon;
import csdl.TblNhanvien;
import java.awt.Color;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;
import org.jfree.chart.ChartFactory;
import org.jfree.chart.ChartFrame;
import org.jfree.chart.ChartPanel;
import org.jfree.chart.JFreeChart;
import org.jfree.chart.plot.CategoryPlot;
import org.jfree.chart.plot.PlotOrientation;
import org.jfree.data.category.DefaultCategoryDataset;

/**
 *
 * @author Administrator
 */
public class thongKe extends javax.swing.JFrame {
    DefaultTableModel tablemodel;
    XLDL tkdl;
    XLDL nvdl;
    UrlKN url;
    Dao dao;
    KNCSDL kn;
    /**
     * Creates new form thongKe
     */
    
    public thongKe() {
        initComponents();
        tkdl=new XLDL();
        nvdl= new XLDL();
        kn= new KNCSDL();
        url=new UrlKN();
        dao= new Dao(url.knURL());
        thongkedoanhthu();
       
    }
    void thongkedoanhthu(){
       ArrayList<csdl.thongKe> list= new ArrayList<>();
        try {
            list=tkdl.thongKe();  
            DefaultCategoryDataset dcd = new DefaultCategoryDataset();
            for(csdl.thongKe item : list){
                  dcd.setValue(item.getDoanhthu(), item.getLoai(), item.getThang());
            }
       
          JFreeChart jcChart= ChartFactory.createBarChart("Doanh thu","Tháng","Doanh thu", dcd, PlotOrientation.VERTICAL, true, true, false);
          CategoryPlot plot= jcChart.getCategoryPlot();
          plot.setRangeGridlinePaint(Color.BLACK);
          ChartFrame chartFrame= new ChartFrame("Hóa Đơn ",jcChart,true);
       
          ChartPanel chartPanel= new ChartPanel(jcChart);
          pnlchar.removeAll();
          pnlchar.add(chartPanel);
          pnlchar.updateUI();
            
        } catch (SQLException ex) {
            Logger.getLogger(thongKe.class.getName()).log(Level.SEVERE, null, ex);
        }
       
    }
    void loadHD(){
       
        ArrayList<TblHoadon>list= new ArrayList<>();
        try{
           
        list = tkdl.getListthongkeHD(cbott.getSelectedItem().toString());
        tablemodel = (DefaultTableModel) tblHD.getModel();
        for(TblHoadon hd : list){
            tablemodel.addRow(new Object[]{hd.getMahoadon(), hd.getMadattour(), hd.getNgaylap(), hd.getTennv(), hd.getTongtien(), hd.getTrangthai()});
        }
        }catch(SQLException ex){
           JOptionPane.showMessageDialog(this, ex.toString());
            
        }
    }
    void loadNV(String tt,String thuoctinh){
        ArrayList<TblNhanvien>list;
        try{
            list = nvdl.getListthongkeNV(tt,thuoctinh);
            tablemodel = (DefaultTableModel) tblNV.getModel();
            for(TblNhanvien nv : list){
                tablemodel.addRow(new Object[]{nv.getManv(), nv.getHotennv(), nv.getNgaysinh(), nv.getGioitinh(), nv.getCmnd(), nv.getDiachi(), nv.getSdt(), nv.getNgayvaolam(), nv.getTenPTC(), nv.getTenCV(), nv.getHinhanh()});
            }
        }catch(SQLException ex){
            
        }
        
    }
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        tblPn = new javax.swing.JTabbedPane();
        jPanel2 = new javax.swing.JPanel();
        jSpinner1 = new javax.swing.JSpinner();
        jLabel1 = new javax.swing.JLabel();
        cboGT = new javax.swing.JComboBox<>();
        jLabel6 = new javax.swing.JLabel();
        btnLoc2 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        btnLoc = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        tblNV = new javax.swing.JTable();
        btnThoat = new javax.swing.JLabel();
        jPanel3 = new javax.swing.JPanel();
        jScrollPane2 = new javax.swing.JScrollPane();
        tblHD = new javax.swing.JTable();
        cbott = new javax.swing.JComboBox<>();
        btnLoc3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        btnThoat3 = new javax.swing.JLabel();
        pnlchar = new javax.swing.JPanel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jPanel2.setBackground(new java.awt.Color(0, 153, 153));
        jPanel2.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jSpinner1.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        jPanel2.add(jSpinner1, new org.netbeans.lib.awtextra.AbsoluteConstraints(740, 130, 160, 40));

        jLabel1.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Tuổi:", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 24), new java.awt.Color(255, 255, 255))); // NOI18N
        jPanel2.add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(670, 80, 250, 120));

        cboGT.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        cboGT.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Nam", "Nữ" }));
        jPanel2.add(cboGT, new org.netbeans.lib.awtextra.AbsoluteConstraints(120, 130, 160, 40));

        jLabel6.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Giới tính:", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 24), new java.awt.Color(255, 255, 255))); // NOI18N
        jPanel2.add(jLabel6, new org.netbeans.lib.awtextra.AbsoluteConstraints(50, 80, 250, 120));

        btnLoc2.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        btnLoc2.setForeground(new java.awt.Color(255, 255, 255));
        btnLoc2.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        btnLoc2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icon/outline_filter_alt_white_24dp.png"))); // NOI18N
        btnLoc2.setText("LỌC");
        btnLoc2.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        btnLoc2.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnLoc2MouseClicked(evt);
            }
        });
        jPanel2.add(btnLoc2, new org.netbeans.lib.awtextra.AbsoluteConstraints(340, 140, 100, 50));

        jLabel2.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Thống kê theo:", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 24), new java.awt.Color(255, 255, 255))); // NOI18N
        jPanel2.add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 39, 450, 200));

        btnLoc.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        btnLoc.setForeground(new java.awt.Color(255, 255, 255));
        btnLoc.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        btnLoc.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icon/outline_filter_alt_white_24dp.png"))); // NOI18N
        btnLoc.setText("LỌC");
        btnLoc.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        btnLoc.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnLocMouseClicked(evt);
            }
        });
        jPanel2.add(btnLoc, new org.netbeans.lib.awtextra.AbsoluteConstraints(960, 140, 100, 50));

        jLabel3.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Thống kê theo:", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 24), new java.awt.Color(255, 255, 255))); // NOI18N
        jPanel2.add(jLabel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(610, 40, 470, 200));

        tblNV.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        tblNV.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Mã nhân viên", "Tên nhân viên", "Ngày sinh", "Giới tính", "CMND/CCCD", "Địa chỉ", "SĐT", "Ngày vào làm", "Phòng tổ chức", "Mã chức vụ", "Hình ảnh"
            }
        ));
        tblNV.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tblNVMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(tblNV);

        jPanel2.add(jScrollPane1, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 340, 1370, 360));

        btnThoat.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        btnThoat.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icon/baseline_clear_white_24dp.png"))); // NOI18N
        btnThoat.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        btnThoat.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnThoatMouseClicked(evt);
            }
        });
        jPanel2.add(btnThoat, new org.netbeans.lib.awtextra.AbsoluteConstraints(1330, 0, 40, 40));

        tblPn.addTab("NHÂN VIÊN", jPanel2);

        jPanel3.setBackground(new java.awt.Color(0, 153, 153));
        jPanel3.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        tblHD.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Mã hóa đơn", "Mã đặt tour", "Ngày lập", "Mã nhân viên", "Tổng tiền", "Trạng thái"
            }
        ));
        tblHD.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tblHDMouseClicked(evt);
            }
        });
        jScrollPane2.setViewportView(tblHD);

        jPanel3.add(jScrollPane2, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 340, 1370, 370));

        cbott.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        cbott.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Đã thanh toán", "Chưa thanh toán" }));
        jPanel3.add(cbott, new org.netbeans.lib.awtextra.AbsoluteConstraints(480, 120, 250, 60));

        btnLoc3.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        btnLoc3.setForeground(new java.awt.Color(255, 255, 255));
        btnLoc3.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        btnLoc3.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icon/outline_filter_alt_white_24dp.png"))); // NOI18N
        btnLoc3.setText("LỌC");
        btnLoc3.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        btnLoc3.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnLoc3MouseClicked(evt);
            }
        });
        jPanel3.add(btnLoc3, new org.netbeans.lib.awtextra.AbsoluteConstraints(810, 120, 100, 50));

        jLabel4.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Thống kê theo:", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 24), new java.awt.Color(255, 255, 255))); // NOI18N
        jPanel3.add(jLabel4, new org.netbeans.lib.awtextra.AbsoluteConstraints(400, 50, 540, 200));

        btnThoat3.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        btnThoat3.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icon/baseline_clear_white_24dp.png"))); // NOI18N
        btnThoat3.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        btnThoat3.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                btnThoat3MouseClicked(evt);
            }
        });
        jPanel3.add(btnThoat3, new org.netbeans.lib.awtextra.AbsoluteConstraints(1320, 0, 40, 40));

        tblPn.addTab("HÓA ĐƠN", jPanel3);

        pnlchar.setBackground(new java.awt.Color(0, 153, 153));
        pnlchar.setLayout(new javax.swing.BoxLayout(pnlchar, javax.swing.BoxLayout.LINE_AXIS));
        tblPn.addTab("DOANH THU", pnlchar);

        getContentPane().add(tblPn, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 1370, 710));

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void tblNVMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblNVMouseClicked
        // TODO add your handling code here:
        
    }//GEN-LAST:event_tblNVMouseClicked

    private void tblHDMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblHDMouseClicked
        // TODO add your handling code here:
       
    }//GEN-LAST:event_tblHDMouseClicked

    private void btnLoc3MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnLoc3MouseClicked
        // TODO add your handling code here:
       
        try {
             tablemodel.setRowCount(0);
             tblHD.removeAll();
             loadHD();
           
        } catch (Exception e) {
             loadHD();
        }
        
    }//GEN-LAST:event_btnLoc3MouseClicked

    private void btnLoc2MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnLoc2MouseClicked
        // TODO add your handling code here:
        try {
            tablemodel.setRowCount(0);
            tblNV.removeAll();
            loadNV("gioitinh",cboGT.getSelectedItem().toString());
           
        } catch (Exception e) {
             loadNV("gioitinh",cboGT.getSelectedItem().toString());
        }
        
    }//GEN-LAST:event_btnLoc2MouseClicked

    private void btnLocMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnLocMouseClicked
        // TODO add your handling code here:
        try {
            tablemodel.setRowCount(0);
            tblNV.removeAll();
            loadNV("tuoi",jSpinner1.getValue().toString());
           
        } catch (Exception e) {
                loadNV("tuoi",jSpinner1.getValue().toString());
        }
    }//GEN-LAST:event_btnLocMouseClicked

    private void btnThoatMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnThoatMouseClicked
        // TODO add your handling code here:
        this.setVisible(false);
    }//GEN-LAST:event_btnThoatMouseClicked

    private void btnThoat3MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_btnThoat3MouseClicked
        // TODO add your handling code here:
        this.setVisible(false);
    }//GEN-LAST:event_btnThoat3MouseClicked

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(thongKe.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(thongKe.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(thongKe.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(thongKe.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new thongKe().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel btnLoc;
    private javax.swing.JLabel btnLoc2;
    private javax.swing.JLabel btnLoc3;
    private javax.swing.JLabel btnThoat;
    private javax.swing.JLabel btnThoat3;
    private javax.swing.JComboBox<String> cboGT;
    private javax.swing.JComboBox<String> cbott;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JSpinner jSpinner1;
    private javax.swing.JPanel pnlchar;
    private javax.swing.JTable tblHD;
    private javax.swing.JTable tblNV;
    private javax.swing.JTabbedPane tblPn;
    // End of variables declaration//GEN-END:variables
}
